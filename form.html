<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Booking Form</title>
<style>
  :root{--radius:16px;--space-1:.5rem;--space-2:1rem;--space-3:1.5rem;--space-4:2rem;--fg:#0b0b0c;--bg:#f7f7f8;--card:#ffffff;--muted:#666;--brand:#0a84ff}
  *{box-sizing:border-box} html,body{margin:0}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg);line-height:1.5}
  .wrap{width:min(100%,720px);margin:clamp(16px,4vw,48px) auto;padding:0 var(--space-2)}
  .card{background:var(--card);border:1px solid #eee;border-radius:var(--radius);padding:var(--space-3);box-shadow:0 1px 2px rgba(0,0,0,.04)}
  h1{margin:0 0 .25rem;font-size:clamp(1.5rem,2.5vw,2rem)}
  .muted{color:var(--muted);margin:0 0 var(--space-3)}
  form{display:grid;gap:var(--space-2)}
  .grid{display:grid;gap:var(--space-2)} .grid-2{grid-template-columns:1fr}
  @media (min-width:720px){ .grid-2{grid-template-columns:1fr 1fr} }
  label{font-weight:600} .opt{font-weight:400;color:var(--muted)}
  input, select, textarea{width:100%;padding:.8rem .9rem;border:1px solid #ddd;border-radius:12px;background:#fff;font:inherit}
  input:focus,select:focus,textarea:focus{outline:2px solid var(--brand);outline-offset:2px;border-color:transparent}

  /* ‚¨áÔ∏è Updated consent row styles */
  .row{
    display:grid;
    align-items:20px 1fr;   /* top-align checkbox with first line */
    gap:.6rem;
    max-width:100%;
  }
  .row input[type="checkbox"]{
    width: 18px;
    height: 18px;
    margin-top:.2rem;        /* tiny nudge for visual alignment */
  }
  .row label{
    margin: 0;            /* take remaining width */
    line-height:1.4;
    white-space: normal;
    overflow-wrap: break-word;   /* prevent overflow on narrow screens */
    word-break:normal;
  }
  .row.full{ grid-column:1 / -1; }  /* span both columns on desktop */

  .help{font-size:.9rem;color:var(--muted)}
  .actions{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:.5rem}
  .btn{border:1px solid #ddd;background:#fff;padding:.8rem 1.1rem;border-radius:999px;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Booking Details</h1>
      <p class="muted">Fill this out so I know who/when/where to shoot. You‚Äôll confirm payment next.</p>

      <form id="bookingForm" novalidate>
        <input type="hidden" name="package" id="package" />

        <div class="grid grid-2">
          <div>
            <label for="firstName">First name</label>
            <input id="firstName" name="firstName" autocomplete="given-name" required />
          </div>
          <div>
            <label for="lastName">Last name <span class="opt">(optional)</span></label>
            <input id="lastName" name="lastName" autocomplete="family-name" />
          </div>
        </div>

        <div class="grid grid-2">
          <div>
            <label for="instagram">Instagram</label>
            <!-- UPDATED pattern + title -->
            <input id="instagram" name="instagram" placeholder="@username"
                   inputmode="text"
                   pattern="^@[A-Za-z0-9._]{1,30}$"
                   title="Use @handle (letters, numbers, dots and underscores only, no spaces)"
                   required />
            <div class="help">Use @handle (letters, numbers, . and _ )</div>
          </div>
          <div>
            <label for="phone">Phone</label>
            <input id="phone" name="phone" type="tel" autocomplete="tel" inputmode="tel" placeholder="(555) 555-5555" required />
          </div>
        </div>

        <div class="grid grid-2">
          <div>
            <label for="jersey">Jersey # <span class="opt">(optional)</span></label>
            <!-- FIXED pattern (single backslash) -->
            <input id="jersey" name="jersey" inputmode="numeric" pattern="^\d{1,3}$" placeholder="e.g., 10" />
          </div>
          <div>
            <label for="position">Position <span class="opt">(optional)</span></label>
            <input id="position" name="position" placeholder="e.g., Striker" />
          </div>
        </div>

        <div>
          <label for="school">School / Club name</label>
          <input id="school" name="school" required />
        </div>

        <div class="grid grid-2">
          <div>
            <label for="gameTime">Game time</label>
            <input id="gameTime" name="gameTime" type="datetime-local" required />
          </div>
          <div>
            <label for="location">Location</label>
            <input id="location" name="location" placeholder="Stadium / field address" required />
          </div>
        </div>

        <!-- ‚¨áÔ∏è Add 'full' so it spans both columns nicely -->
        <div class="row full">
          <input id="agree" type="checkbox" required />
          <label for="agree">I confirm the info is correct.</label>
        </div>

        <div class="actions">
          <button type="button" class="btn" id="backBtn">Back</button>
          <button type="submit" class="btn primary">Continue to Payment</button>
        </div>
      </form>
    </div>
  </div>

<script>
  // Get ?pkg=
  const params = new URLSearchParams(window.location.search);
  const pkg = params.get("pkg") || "custom";
  document.getElementById("package").value = pkg;

  // üëá Your /exec URL
  const GOOGLE_ENDPOINT = "https://script.google.com/macros/s/AKfycbwnVbopLCKWuKezB8AjRezRxuCOvo6Uou5MX6tQji9EqKnY6ybkZZyL4qTcyz2kY7KLZg/exec";

  // Normalize IG + phone
  const ig = document.getElementById("instagram");
  ig.addEventListener("blur", () => {
    if (ig.value && !ig.value.startsWith("@")) ig.value = "@" + ig.value.trim();
  });

  const phone = document.getElementById("phone");
  phone.addEventListener("blur", () => {
    const digits = phone.value.replace(/\D/g, "");
    if (digits.length === 10) {
      phone.value = `(${digits.slice(0,3)}) ${digits.slice(3,6)}-${digits.slice(6)}`;
    }
  });

  // Back
  document.getElementById("backBtn").addEventListener("click", () => {
    history.length > 1 ? history.back() : (window.location.href = "./index.html");
  });

  // Submit -> save, send to Sheets, and go to payment step
  document.getElementById("bookingForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    if (!e.target.checkValidity()) { 
      e.target.reportValidity(); 
      return; 
    }

    const data = Object.fromEntries(new FormData(e.target).entries());

    // Save locally for payment.html
    try { 
      localStorage.setItem("bookingInfo", JSON.stringify(data)); 
    } catch (_) {}

    // Send to Google Sheets
    try {
      await fetch(GOOGLE_ENDPOINT, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
    } catch (err) {
      console.warn("Sheets send failed:", err);
    }

    // Redirect to payment page
    window.location.href = `./payment.html?pkg=${encodeURIComponent(pkg)}`;
  });
</script>
</body>
</html>